# DB storage tools

## Storage engine usage reporting

This script is primarily designed to evaluate disk utilisation (including "_fragmentation_") for DB maintainance and for capacity planning tasks.

The [dbstats.js](src/dbstats.js) script provides a basic tabular report of DB internal storage and some dervied metrics:

* Data size (uncompressed)
* Storage size (on disk)
* Document count
* Free blocks (reclaimable space)
* Compression

### Usage

Sample syntax to run against on the _mongo_ shell:

```bash
mongo [+options] --quiet dbstats.js
```

### Sample output

```text
========================================================================================================================
Database: admin
------------------------------------------------------------------------------------------------------------------------
 Collection                        Data size     Size on disk        Obj count      Free blocks (reuse)      Compression
------------------------------------------------------------------------------------------------------------------------
  system.version                     0.00 MB          0.03 MB                1          0.01 MB (37.5%)           0.00:1
------------------------------------------------------------------------------------------------------------------------
Collection subtotals:                0.00 MB          0.03 MB                1          0.01 MB (37.5%)           0.00:1
DB Index size:                                        0.06 MB
Subtotal:                            0.00 MB          0.09 MB                1          0.01 MB (37.5%)           0.00:1
========================================================================================================================
========================================================================================================================
Database: config
------------------------------------------------------------------------------------------------------------------------
 Collection                        Data size     Size on disk        Obj count      Free blocks (reuse)      Compression
------------------------------------------------------------------------------------------------------------------------
  system.sessions                    0.00 MB          0.00 MB                0          0.00 MB  (0.0%)           0.00:1
------------------------------------------------------------------------------------------------------------------------
Collection subtotals:                0.00 MB          0.00 MB                0          0.00 MB  (0.0%)           0.00:1
DB Index size:                                        0.01 MB
Subtotal:                            0.00 MB          0.01 MB                0          0.00 MB  (0.0%)           0.00:1
========================================================================================================================
========================================================================================================================
Database: foo
------------------------------------------------------------------------------------------------------------------------
 Collection                        Data size     Size on disk        Obj count      Free blocks (reuse)      Compression
------------------------------------------------------------------------------------------------------------------------
  bar                                0.00 MB          0.04 MB                4          0.02 MB (44.4%)           0.01:1
------------------------------------------------------------------------------------------------------------------------
Collection subtotals:                0.00 MB          0.04 MB                4          0.02 MB (44.4%)           0.01:1
DB Index size:                                        0.03 MB
Subtotal:                            0.00 MB          0.07 MB                4          0.02 MB (44.4%)           0.01:1
========================================================================================================================
========================================================================================================================
Database: local
------------------------------------------------------------------------------------------------------------------------
 Collection                        Data size     Size on disk        Obj count      Free blocks (reuse)      Compression
------------------------------------------------------------------------------------------------------------------------
  startup_log                        0.05 MB          0.04 MB               31          0.02 MB (36.4%)           1.93:1
------------------------------------------------------------------------------------------------------------------------
Collection subtotals:                0.05 MB          0.04 MB               31          0.02 MB (36.4%)           1.93:1
DB Index size:                                        0.04 MB
Subtotal:                            0.05 MB          0.08 MB               31          0.02 MB (36.4%)           1.93:1
========================================================================================================================
========================================================================================================================
Database: mydb
------------------------------------------------------------------------------------------------------------------------
 Collection                        Data size     Size on disk        Obj count      Free blocks (reuse)      Compression
------------------------------------------------------------------------------------------------------------------------
  users                              0.00 MB          0.03 MB                1          0.01 MB (37.5%)           0.00:1
------------------------------------------------------------------------------------------------------------------------
Collection subtotals:                0.00 MB          0.03 MB                1          0.01 MB (37.5%)           0.00:1
DB Index size:                                        0.03 MB
Subtotal:                            0.00 MB          0.06 MB                1          0.01 MB (37.5%)           0.00:1
========================================================================================================================
========================================================================================================================
Database: schema
------------------------------------------------------------------------------------------------------------------------
 Collection                        Data size     Size on disk        Obj count      Free blocks (reuse)      Compression
------------------------------------------------------------------------------------------------------------------------
  schemas                            0.02 MB          0.04 MB                3          0.02 MB (44.4%)           1.25:1
------------------------------------------------------------------------------------------------------------------------
Collection subtotals:                0.02 MB          0.04 MB                3          0.02 MB (44.4%)           1.25:1
DB Index size:                                        0.04 MB
Subtotal:                            0.02 MB          0.07 MB                3          0.02 MB (44.4%)           1.25:1
========================================================================================================================
========================================================================================================================
Database: test
------------------------------------------------------------------------------------------------------------------------
 Collection                        Data size     Size on disk        Obj count      Free blocks (reuse)      Compression
------------------------------------------------------------------------------------------------------------------------
  taxidata                        3135.93 MB       2352.93 MB          3926576        226.21 MB  (9.6%)           1.47:1
------------------------------------------------------------------------------------------------------------------------
  tripsdata                          0.09 MB          0.05 MB              100          0.01 MB (21.4%)           2.13:1
------------------------------------------------------------------------------------------------------------------------
Collection subtotals:             3136.02 MB       2352.99 MB          3926676        226.23 MB  (9.6%)           1.47:1
DB Index size:                                      175.98 MB
Subtotal:                         3136.02 MB       2528.96 MB          3926676        226.23 MB  (9.6%)           1.47:1
========================================================================================================================

========================================================================================================================
Rollup stats                       Data size     Size on disk        Obj count      Free blocks (reuse)      Compression
------------------------------------------------------------------------------------------------------------------------
DB subtotals:                     3136.10 MB       2353.17 MB          3926716        226.30 MB  (9.6%)           1.47:1
All indexes:                                        176.18 MB
Total:                            3136.10 MB       2529.35 MB          3926716        226.30 MB  (9.6%)           1.47:1
========================================================================================================================
```

## WiredTiger internals

This script is designed to enumerate the _`.wt`_ files in the _`$dbPath`_ and provide a visualisation of the storage engine page structures and layout.

TBA: [wtfrag.py](src/wtfrag.py)

### Usage

```bash
./wtfrag.py
```
